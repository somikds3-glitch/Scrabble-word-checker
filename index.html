<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Somik’s Scrabble Word Panel — Strict No-Key</title>
<style>
  :root{--bg:#0f1226;--card:#181b3a;--ink:#eef0ff;--muted:#9aa0ff;--ok:#34c38f;--no:#ff6b6b;--line:#2a2f63}
  *{box-sizing:border-box} body{margin:0;font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;background:radial-gradient(1200px 700px at 70% -10%,#1a2050,#0f1226);color:var(--ink)}
  .wrap{max-width:720px;margin:6vh auto;padding:0 16px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:20px}
  h1{margin:0 0 8px} .sub{color:#c6caff;margin:0 0 14px}
  form{display:flex;gap:8px;flex-wrap:wrap}
  input{flex:1 1 260px;padding:12px;border-radius:10px;border:1px solid var(--line);background:#0f1230;color:var(--ink);font-size:16px}
  button{padding:10px 14px;border-radius:10px;border:1px solid var(--line);background:#2a2f63;color:var(--ink);cursor:pointer}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:14px}
  .panel{border:1px dashed var(--line);border-radius:10px;padding:12px;min-height:110px;position:relative}
  .tag{position:absolute;top:8px;right:8px;color:var(--muted);font-size:12px}
  .status{font-size:18px;margin-top:6px}
  .def{margin-top:8px;color:#d7dbff}
  .mini{color:var(--muted);font-size:12px;margin-top:8px}
  a{color:#cfd3ff}
  .ok{color:var(--ok)} .no{color:var(--no)}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Somik’s Scrabble Word Panel</h1>
    <p class="sub">Enter one word. No list, no API key. “Playable” only when Collins explicitly says so. Definitions from Collins & Merriam if found.</p>

    <form id="f">
      <input id="w" type="text" placeholder="Type a word (e.g., gapy, tod)" maxlength="15" autocomplete="off" />
      <button type="submit">Check</button>
    </form>

    <div class="row">
      <div class="panel">
        <div class="tag">CSW (Collins)</div>
        <div id="cswStatus" class="status">—</div>
        <div id="cswDef" class="def">—</div>
        <div id="cswNote" class="mini"></div>
      </div>
      <div class="panel">
        <div class="tag">NWL (Merriam) — info</div>
        <div id="nwlStatus" class="status">—</div>
        <div id="nwlDef" class="def">—</div>
        <div id="nwlNote" class="mini"></div>
      </div>
    </div>

    <div class="mini" style="margin-top:12px">Confidence: High = Collins explicitly confirmed; Unknown = not confirmed; Always shows source links for manual verification.</div>
    <div class="mini" id="links" style="margin-top:6px"></div>
  </div>
</div>

<script>
/* Strict no-key checker:
   - Only mark csw ok when Collins text contains "is a valid scrabble word"
   - Merriam is only informational and can mark "not allowed" if it says "No results" or similar.
   - Uses r.jina.ai mirror to avoid CORS (read-only).
   - Small BLOCKLIST to prevent obscene words from being shown as playable.
*/

const form = document.getElementById('f');
const wIn = document.getElementById('w');
const cswStatus = document.getElementById('cswStatus');
const cswDef = document.getElementById('cswDef');
const cswNote = document.getElementById('cswNote');
const nwlStatus = document.getElementById('nwlStatus');
const nwlDef = document.getElementById('nwlDef');
const nwlNote = document.getElementById('nwlNote');
const linksDiv = document.getElementById('links');

const BLOCKLIST = new Set([
  // add words you never want to show; keep this list as you see fit
  "bhosdike", "motherfucker", "cunt", "fucker", "fuck"
]);

function jina(url){ return `https://r.jina.ai/http://${url.replace(/^https?:\/\//,'')}`; }

async function fetchText(url, timeout=5000){
  const controller = new AbortController();
  const id = setTimeout(()=>controller.abort(), timeout);
  try {
    const res = await fetch(jina(url), { signal: controller.signal, cache: 'no-store' });
    clearTimeout(id);
    if (!res.ok) throw new Error('Fetch failed: '+res.status);
    return await res.text();
  } catch (e){
    clearTimeout(id);
    throw e;
  }
}

function sanitize(s){
  const v = (s||'').trim();
  if (!/^[A-Za-z]{2,15}$/.test(v)) return null;
  return v.toLowerCase();
}

function extractCollinsDef(text){
  // heuristic: find the first line after the "is a valid scrabble word" sentence that looks like a definition
  const lines = text.split(/\n+/).map(l=>l.trim()).filter(Boolean);
  const idx = lines.findIndex(l => /is a valid scrabble word/i.test(l));
  if (idx >= 0){
    for (let i = idx+1; i < Math.min(lines.length, idx+8); i++){
      const L = lines[i];
      if (L.length > 10 && L.split(' ').length < 30) return L.slice(0,180);
    }
  }
  // fallback: try first short dictionary-ish line
  const cand = lines.find(l => /^[a-z].{3,}/i.test(l) && l.split(' ').length <= 20);
  return cand ? cand.slice(0,180) : '';
}

function extractMerriamDef(text){
  const lines = text.split(/\n+/).map(l=>l.trim()).filter(Boolean);
  // find "definition" or short lines near top
  const ix = lines.findIndex(l => /definition/i.test(l));
  if (ix >= 0 && lines[ix+1]) return lines[ix+1].slice(0,180);
  const cand = lines.find(l => /^[a-z].{3,}/i.test(l) && l.split(' ').length <= 20);
  return cand ? cand.slice(0,180) : '';
}

function renderStatus(el, state, note=''){
  el.className = 'status ' + (state==='ok' ? 'ok' : state==='no' ? 'no' : '');
  el.textContent = state==='ok' ? 'Playable ✓' : state==='no' ? 'Not allowed ✕' : 'Unknown';
  if (note) el.nextElementSibling && (el.nextElementSibling.textContent = note);
}

form.addEventListener('submit', async (ev)=>{
  ev.preventDefault();
  cswStatus.textContent = '…'; cswDef.textContent = '—'; cswNote.textContent = '';
  nwlStatus.textContent = '…'; nwlDef.textContent = '—'; nwlNote.textContent = '';
  linksDiv.innerHTML = '';

  const raw = wIn.value;
  const w = sanitize(raw);
  if (!w) {
    cswStatus.textContent = 'Letters A–Z only (2–15 chars)';
    nwlStatus.textContent = '';
    return;
  }
  if (BLOCKLIST.has(w)){
    cswStatus.textContent = 'Blocked by policy';
    nwlStatus.textContent = '';
    return;
  }

  const srcCSW = `https://www.collinsdictionary.com/scrabble/scrabble-word-checker/${w}`;
  const srcNWL = `https://scrabble.merriam.com/finder/${w}`;

  // show quick links
  const a1 = document.createElement('a'); a1.href = srcCSW; a1.target='_blank'; a1.rel='noopener'; a1.textContent = `Open Collins for "${w}"`;
  const a2 = document.createElement('a'); a2.href = srcNWL; a2.target='_blank'; a2.rel='noopener'; a2.textContent = `Open Merriam for "${w}"`;
  linksDiv.appendChild(a1); linksDiv.appendChild(document.createTextNode(' — ')); linksDiv.appendChild(a2);

  try {
    // CSW first (fast). Only mark ok if exact phrase found.
    const cswText = await fetchText(srcCSW, 5000);
    const cswOk = /is a valid scrabble word/i.test(cswText);
    if (cswOk){
      renderStatus(cswStatus, 'ok', 'Collins explicitly confirms.');
    } else if (/is not a valid scrabble word/i.test(cswText) || /not found/i.test(cswText) || /no results/i.test(cswText)){
      renderStatus(cswStatus, 'no', 'Collins explicitly rejects.');
    } else {
      renderStatus(cswStatus, 'unknown', 'Collins did not explicitly confirm.');
    }
    const cdef = extractCollinsDef(cswText);
    cswDef.textContent = cdef || 'No short Collins gloss found on page.';

    // Merriam (NWL) only as info: if explicit "no results" -> not allowed; otherwise provide definition snippet if present.
    try {
      const nwlText = await fetchText(srcNWL, 6000);
      const nwlNo = /no results/i.test(nwlText) || /not a playable word/i.test(nwlText);
      if (nwlNo) renderStatus(nwlStatus, 'no', 'Merriam shows no results / rejects.');
      else renderStatus(nwlStatus, 'unknown', 'Merriam did not explicitly confirm (info only).');

      const mdef = extractMerriamDef(nwlText);
      nwlDef.textContent = mdef || 'No short Merriam gloss found on page.';
    } catch (me){
      nwlStatus.textContent = 'Merriam fetch failed';
      nwlNote.textContent = String(me).slice(0,120);
    }

  } catch (e){
    cswStatus.textContent = 'Collins fetch failed';
    cswNote.textContent = String(e).slice(0,120);
  }
});
</script>
</body>
</html>